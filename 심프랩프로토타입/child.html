<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë§¤ì•„ë¦¬ ê·¸ë¦¼ì¼ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: 'Pretendard', sans-serif; background-color: #FAFAFA; color: #333; margin: 0; padding: 0; }
    header { position: sticky; top: 0; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px);
      border-bottom: 2px solid #FFE08C; display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; }
    header .logo { display: flex; align-items: center; gap: 10px; }
    header .logo-circle { background: #6BB7FF; width: 36px; height: 36px; border-radius: 50%; color: #fff;
      display: grid; place-items: center; font-weight: bold; font-size: 20px; }
    main { max-width: 480px; margin: auto; padding: 16px; padding-bottom: 90px; }
    .card { background: white; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; padding: 16px; }
    .card h2 { font-size: 18px; margin-bottom: 10px; }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .grid div { text-align: center; cursor: pointer; transition: transform 0.2s; }
    .grid div:hover { transform: scale(1.02); }
    .grid img { width: 100%; height: 110px; object-fit: cover; border-radius: 12px; border: 1px solid #ddd; }
    .btn { border: none; border-radius: 16px; padding: 10px 14px; cursor: pointer; font-size: 15px; }
    .btn-primary { background: #6BB7FF; color: white; }
    .btn-outline { background: white; border: 1px solid #ccc; }
    .btn-yellow { background: #FFE08C; color: #333; }
    .btn-danger { background: #F28482; color: white; }
    nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; border-top: 2px solid #FFE08C; background: white; }
    nav button { flex: 1; padding: 12px 0; text-align: center; background: none; border: none; font-size: 14px; cursor: pointer; color: gray; }
    nav button.active { color: #6BB7FF; font-weight: bold; }
    canvas { background: #fff; border: 2px solid #FFE08C; border-radius: 16px; width: 100%; height: 200px; cursor: crosshair; display:block; }
    textarea { width: 100%; height: 80px; border-radius: 12px; border: 1px solid #ccc; padding: 8px; margin-top: 8px; font-family: inherit; resize: none; }
    select, input[type="date"] { width: 100%; border-radius: 12px; border: 1px solid #ccc; padding: 6px; margin-top: 8px; font-size: 14px; }
    .color-palette { display: flex; gap: 6px; margin-top: 8px; }
    .color-btn { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; box-shadow: 0 0 2px rgba(0,0,0,0.2); }
    .back-btn { background:#F9B4AB; color:#fff; padding:8px 12px; border:none; border-radius:12px; cursor:pointer; margin-bottom:10px; }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="logo.png" alt="ë§¤ì•„ë¦¬ ë¡œê³ " style="height:36px; border-radius:8px;">
      <div>
        <div style="color:#6BB7FF;font-weight:700;">ë§¤ì•„ë¦¬</div>
        <div style="color:#7DCFB6;font-size:12px;">ë§¤ì¼ ì•„ì´ ì´í•´í•˜ê¸°</div>
      </div>
    </div>
    <div>ğŸŒ¤ï¸</div>
  </header>

  <!-- í™ˆ í™”ë©´ -->
  <main id="screen-home">
    <div class="card">
      <h2>ì˜¤ëŠ˜ ê·¸ë¦¼ì¼ê¸°</h2>
      <div class="grid" id="todayGrid"></div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn btn-yellow" onclick="switchTab('draw')">ğŸ–ï¸ ê·¸ë¦¼ì¼ê¸° ì“°ê¸°</button>
      </div>
    </div>
  </main>

  <!-- ê·¸ë¦¼ ê·¸ë¦¬ê¸° -->
  <main id="screen-draw" style="display:none;">
    <div class="card">
      <h2>ê·¸ë¦¼ ê·¸ë¦¬ê¸°</h2>
      <canvas id="drawCanvas"></canvas>

      <div class="color-palette">
        <div class="color-btn" style="background:black;" onclick="setColor('black')"></div>
        <div class="color-btn" style="background:red;" onclick="setColor('red')"></div>
        <div class="color-btn" style="background:blue;" onclick="setColor('blue')"></div>
        <div class="color-btn" style="background:green;" onclick="setColor('green')"></div>
        <div class="color-btn" style="background:pink;" onclick="setColor('pink')"></div>
        <div class="color-btn" style="background:orange;" onclick="setColor('orange')"></div>
        <button class="btn btn-outline" onclick="toggleEraser()">ğŸ§½ ì§€ìš°ê°œ</button>
      </div>

      <input type="range" id="brushSize" min="2" max="18" value="6" />
      <label>ì˜¤ëŠ˜ ë‚ ì§œ</label>
      <input type="date" id="diaryDate" />
      <label>ë‚ ì”¨</label>
      <select id="weather">
        <option value="â˜€ï¸ ë§‘ìŒ">â˜€ï¸ ë§‘ìŒ</option>
        <option value="ğŸŒ§ï¸ ë¹„">ğŸŒ§ï¸ ë¹„</option>
        <option value="ğŸŒ¤ï¸ íë¦¼">ğŸŒ¤ï¸ íë¦¼</option>
        <option value="ğŸŒˆ ë§‘ê³  ë¬´ì§€ê°œ">ğŸŒˆ ë§‘ê³  ë¬´ì§€ê°œ</option>
        <option value="â„ï¸ ëˆˆ">â„ï¸ ëˆˆ</option>
      </select>
      <textarea id="diaryText" placeholder="ì˜¤ëŠ˜ì˜ ì´ì•¼ê¸°ë¥¼ ì¨ì£¼ì„¸ìš”..."></textarea>
      <div style="margin-top:10px;display:flex;gap:6px;">
        <button class="btn btn-outline" onclick="switchTab('home')">ì·¨ì†Œ</button>
        <button class="btn btn-yellow" onclick="uploadDrawing()">ì™„ì„±!</button>
      </div>
    </div>
  </main>

  <!-- ì¼ê¸° ë³´ê¸° -->
  <main id="screen-view" style="display:none;">
    <div class="card" id="viewCard"></div>
    <button class="back-btn" onclick="switchTab('home')">â† í™ˆìœ¼ë¡œ</button>
  </main>

  <!-- ì¹œêµ¬ í”¼ë“œ -->
  <main id="screen-friends" style="display:none;">
    <div class="card">
      <h2>ì¹œêµ¬ë“¤ì˜ ê·¸ë¦¼ì¼ê¸°</h2>
      <div id="friendsFeed"></div>
    </div>
  </main>
  <!-- ë‚´ í”„ë¡œí•„ -->
  <main id="screen-profile" style="display:none;">
    <div class="card">
      <h2>ë‚´ í”„ë¡œí•„</h2>
      <label>ì´ë¦„</label>
      <input id="myName" placeholder="ì´ë¦„ ì…ë ¥" />
      <label>í•™êµ</label>
      <input id="mySchool" placeholder="ì˜ˆ: ë§¤ì•„ë¦¬ì´ˆë“±í•™êµ" />
      <div style="display:flex; gap:8px;">
        <div style="flex:1;">
          <label>í•™ë…„</label>
          <select id="myGrade">
            <option value="">ì„ íƒ</option>
            <option>1í•™ë…„</option><option>2í•™ë…„</option><option>3í•™ë…„</option>
            <option>4í•™ë…„</option><option>5í•™ë…„</option><option>6í•™ë…„</option>
          </select>
        </div>
        <div style="flex:1;">
          <label>ë°˜</label>
          <select id="myClass">
            <option value="">ì„ íƒ</option>
            <option>1ë°˜</option><option>2ë°˜</option><option>3ë°˜</option>
            <option>4ë°˜</option><option>5ë°˜</option>
          </select>
        </div>
      </div>
      <label>ìê¸°ì†Œê°œ</label>
      <textarea id="myIntro" placeholder="ë‚˜ë¥¼ ì†Œê°œí•´ìš”!"></textarea>
      <button class="btn btn-primary" onclick="saveProfile()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
    </div>

    <div class="card" id="profilePreview" style="display:none;">
      <h2>í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°</h2>
      <p><strong>ì´ë¦„:</strong> <span id="previewName"></span></p>
      <p><strong>í•™êµ:</strong> <span id="previewSchool"></span></p>
      <p><strong>í•™ë…„/ë°˜:</strong> <span id="previewGrade"></span> <span id="previewClass"></span></p>
      <p><strong>ì†Œê°œ:</strong> <span id="previewIntro"></span></p>
      <button class="btn btn-yellow" onclick="editProfile()">âœï¸ ìˆ˜ì •í•˜ê¸°</button>
    </div>
  </main>
  
  <nav>
    <button id="tab-home" class="active" onclick="switchTab('home')">ğŸ  í™ˆ</button>
    <button id="tab-draw" onclick="switchTab('draw')">ğŸ¨ ê·¸ë¦¬ê¸°</button>
    <button id="tab-friends" onclick="switchTab('friends')">ğŸ‘« ì¹œêµ¬ë“¤</button>
    <button id="tab-profile" onclick="switchTab('profile')">ğŸ‘¤ ë‚´ í”„ë¡œí•„</button>
  </nav>

<script>
  const todayGrid = document.getElementById('todayGrid');
  const canvas = document.getElementById('drawCanvas');
  const ctx = canvas.getContext('2d');
  const brushSize = document.getElementById('brushSize');
  const diaryText = document.getElementById('diaryText');
  const diaryDate = document.getElementById('diaryDate');
  const weatherSel = document.getElementById('weather');
  const viewCard = document.getElementById('viewCard');
  const friendsFeed = document.getElementById('friendsFeed');

  let drawing = false;
  let drawings = [];
  let currentColor = 'black';
  let eraserMode = false;
  let editDiary = null;
  let lastX = 0, lastY = 0;

  // ìº”ë²„ìŠ¤ í¬ê¸° ìë™ ì¡°ì •
  function setCanvasSize() {
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
  }
  window.addEventListener('load', setCanvasSize);
  window.addEventListener('resize', setCanvasSize);

  // ê³µí†µ ì¢Œí‘œ ê³„ì‚° (í„°ì¹˜/ë§ˆìš°ìŠ¤ ëª¨ë‘ ì§€ì›)
  function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    if (e.touches && e.touches.length > 0) {
      return [e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top];
    } else {
      return [e.clientX - rect.left, e.clientY - rect.top];
    }
  }

  function startDraw(e) {
    drawing = true;
    const [x, y] = getPos(e);
    [lastX, lastY] = [x, y];
  }

  function draw(e) {
    if (!drawing) return;
    e.preventDefault(); // ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ ë°©ì§€
    const [x, y] = getPos(e);
    ctx.strokeStyle = eraserMode ? "#fff" : currentColor;
    ctx.lineWidth = brushSize.value;
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    [lastX, lastY] = [x, y];
  }

  function stopDraw() {
    drawing = false;
  }

  // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
  canvas.addEventListener('mousedown', startDraw);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', stopDraw);
  canvas.addEventListener('mouseout', stopDraw);

  // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ëŒ€ì‘)
  canvas.addEventListener('touchstart', startDraw);
  canvas.addEventListener('touchmove', draw, { passive: false }); // preventDefault() í™œì„±í™”
  canvas.addEventListener('touchend', stopDraw);

// ìƒ‰ìƒ, ì§€ìš°ê°œ ê¸°ëŠ¥
function setColor(color) {
  currentColor = color;
  eraserMode = false;

  // ëª¨ë“  ìƒ‰ìƒ ë²„íŠ¼ ì´ˆê¸°í™”
  document.querySelectorAll('.color-btn').forEach(btn => {
    btn.style.outline = '';
    btn.style.boxShadow = '';
  });

  // ì„ íƒëœ ìƒ‰ìƒ ê°•ì¡° (í…Œë‘ë¦¬)
  const selected = Array.from(document.querySelectorAll('.color-btn'))
    .find(btn => btn.style.background === color);
  if (selected) {
    selected.style.outline = '3px solid #FFE08C';
    selected.style.boxShadow = '0 0 6px #FFE08C';
  }

  // ì§€ìš°ê°œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
  const eraserBtn = document.querySelector('.color-palette button');
  if (eraserBtn) {
    eraserBtn.style.background = '';
    eraserBtn.style.color = '';
    eraserBtn.style.border = '1.5px solid #ccc';
  }
}

function toggleEraser() {
  eraserMode = !eraserMode;
  const eraserBtn = document.querySelector('.color-palette button');

  if (eraserMode) {
    eraserBtn.style.background = '#FFE08C';  // í¬ë¦¼ ì˜ë¡œ ê°•ì¡°
    eraserBtn.style.color = '#333';
    eraserBtn.style.border = '2px solid #E1B000';
  } else {
    eraserBtn.style.background = '';
    eraserBtn.style.color = '';
    eraserBtn.style.border = '1.5px solid #ccc';
  }

  // ìƒ‰ìƒ ë²„íŠ¼ ê°•ì¡° í•´ì œ
  document.querySelectorAll('.color-btn').forEach(btn => {
    btn.style.outline = '';
    btn.style.boxShadow = '';
  });
}


  // íƒ­ ì „í™˜
  function switchTab(tab) {
    document.querySelectorAll('main').forEach(m => m.style.display = 'none');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.getElementById(`screen-${tab}`).style.display = 'block';
    const tabBtn = document.getElementById(`tab-${tab}`);
    if (tabBtn) tabBtn.classList.add('active');
    if (tab === 'draw') setTimeout(setCanvasSize, 100);
    if (tab === 'friends') renderFriendsFeed();
    if (tab === 'profile') loadProfile();
  }

  // ì—…ë¡œë“œ ë° ì¼ê¸° ë Œë”ë§
  function uploadDrawing() {
    const imageData = canvas.toDataURL();
    const text = diaryText.value.trim() || "ë¬´ì œ";
    const date = diaryDate.value || new Date().toISOString().split('T')[0];
    const weather = weatherSel.value;
    if (editDiary) {
      editDiary.imageData = imageData;
      editDiary.text = text;
      editDiary.date = date;
      editDiary.weather = weather;
      editDiary = null;
    } else {
      drawings.push({ imageData, text, date, weather });
    }
    renderGrid();
    diaryText.value = "";
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    switchTab('home');
  }

  function renderGrid() {
    todayGrid.innerHTML = "";
    drawings.forEach(diary => {
      const div = document.createElement('div');
      div.innerHTML = `<img src="${diary.imageData}"><div style="font-size:11px;color:gray;">${diary.date}<br>${diary.weather}</div>`;
      div.onclick = () => openDiary(diary);
      todayGrid.prepend(div);
    });
  }

    // í”„ë¡œí•„ ì €ì¥
    function saveProfile() {
      const name = myName.value;
      const school = mySchool.value;
      const grade = myGrade.value;
      const classNum = myClass.value;
      const intro = myIntro.value;

      const profile = { name, school, grade, classNum, intro };
      localStorage.setItem('maeariProfile', JSON.stringify(profile));
      alert("í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…");
      showProfilePreview(profile);
    }

    // í”„ë¡œí•„ ë¡œë“œ
    function loadProfile() {
      const saved = localStorage.getItem('maeariProfile');
      if (!saved) return;
      const p = JSON.parse(saved);
      myName.value = p.name;
      mySchool.value = p.school;
      myGrade.value = p.grade;
      myClass.value = p.classNum;
      myIntro.value = p.intro;
      showProfilePreview(p);
    }

    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
    function showProfilePreview(p) {
      document.getElementById('profilePreview').style.display = 'block';
      document.getElementById('previewName').innerText = p.name;
      document.getElementById('previewSchool').innerText = p.school;
      document.getElementById('previewGrade').innerText = p.grade;
      document.getElementById('previewClass').innerText = p.classNum;
      document.getElementById('previewIntro').innerText = p.intro;
    }

    // ìˆ˜ì •ëª¨ë“œë¡œ ëŒì•„ê°€ê¸°
    function editProfile() {
      document.getElementById('profilePreview').style.display = 'none';
    }

    function openDiary(diary) {
      switchTab('view');
      viewCard.innerHTML = `
        <h2>${diary.date} / ${diary.weather}</h2>
        <img src="${diary.imageData}" style="width:100%;border-radius:12px;border:1px solid #ddd;margin-bottom:10px;">
        <p style="font-size:15px;">${diary.text}</p>
        <div style="display:flex;gap:6px;justify-content:flex-end;">
          <button class="btn btn-yellow" onclick="editExistingDiary('${diary.date}')">âœï¸ ìˆ˜ì •</button>
          <button class="btn btn-danger" onclick="deleteDiary('${diary.date}')">ğŸ—‘ï¸ ì‚­ì œ</button>
        </div>
      `;
    }

    function deleteDiary(date) {
      if (!confirm("ì •ë§ ì´ ê·¸ë¦¼ì¼ê¸°ë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;
      drawings = drawings.filter(d => d.date !== date);
      renderGrid();
      alert("ê·¸ë¦¼ì¼ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ—‘ï¸");
      switchTab('home');
    }

    function editExistingDiary(date) {
      const diary = drawings.find(d => d.date === date);
      if (!diary) return;
      editDiary = diary;
      switchTab('draw');
      diaryText.value = diary.text;
      diaryDate.value = diary.date;
      weatherSel.value = diary.weather;
      const img = new Image();
      img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      img.src = diary.imageData;
    }

    // --- ì¹œêµ¬ë“¤ SNS í”¼ë“œ ---
    const friendPosts = [
      { name: "ë¯¼ìˆ˜", date: "2025-10-15", weather: "â˜€ï¸ ë§‘ìŒ", image: "https://picsum.photos/seed/f1/400/250", text: "í•™êµ ìš´ë™ì¥ì—ì„œ ì¹œêµ¬ë“¤ê³¼ ì¶•êµ¬í–ˆì–´ìš”!", likes: 12, comments: 3 },
      { name: "ì†Œì—°", date: "2025-10-16", weather: "ğŸŒ§ï¸ ë¹„", image: "https://picsum.photos/seed/f2/400/250", text: "ë¹„ ì˜¤ëŠ” ë‚  ì°½ë¬¸ì— ê·¸ë¦¼ì„ ê·¸ë ¸ì–´ìš” â˜”", likes: 7, comments: 1 },
      { name: "ì§€í˜¸", date: "2025-10-17", weather: "ğŸŒˆ ë§‘ê³  ë¬´ì§€ê°œ", image: "https://picsum.photos/seed/f3/400/250", text: "í•˜ëŠ˜ì— ë¬´ì§€ê°œê°€ ë–´ì–´ìš”! ë„ˆë¬´ ì˜ˆë»ìš” ğŸŒˆ", likes: 22, comments: 4 }
    ];

    function renderFriendsFeed() {
      friendsFeed.innerHTML = "";
      friendPosts.forEach(post => {
        const div = document.createElement("div");
        div.className = "card";
        div.style.marginBottom = "16px";
        div.innerHTML = `
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
            <div style="background:#6BB7FF;width:36px;height:36px;border-radius:50%;color:#fff;display:grid;place-items:center;font-weight:bold;">
              ${post.name[0]}
            </div>
            <div>
              <div style="font-weight:600;">${post.name}</div>
              <div style="font-size:12px;color:gray;">${post.date} / ${post.weather}</div>
            </div>
          </div>
          <img src="${post.image}" style="width:100%;border-radius:12px;border:1px solid #ddd;margin-bottom:8px;">
          <p style="font-size:15px;">${post.text}</p>
          <div style="display:flex;justify-content:space-around;margin-top:8px;font-size:14px;color:#6BB7FF;">
            <button class="btn btn-outline" onclick="alert('ì¢‹ì•„ìš”! â¤ï¸')">â¤ï¸ ${post.likes}</button>
            <button class="btn btn-outline" onclick="alert('ëŒ“ê¸€ ê¸°ëŠ¥ì€ ì¤€ë¹„ì¤‘ì´ì—ìš” ğŸ’¬')">ğŸ’¬ ${post.comments}</button>
            <button class="btn btn-outline" onclick="alert('ê³µìœ  ê¸°ëŠ¥ì€ ì¤€ë¹„ì¤‘ì´ì—ìš” ğŸ”')">ğŸ” ê³µìœ </button>
          </div>
        `;
        friendsFeed.appendChild(div);
      });
    }
  </script>
</body>
</html>
