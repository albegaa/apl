<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>êµì‚¬ìš© ë§¤ì•„ë¦¬</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-[#FAFAFA] text-[#333]">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // ìœ„í—˜ë„ ë±ƒì§€
      function RiskBadge({ risk }) {
        const style =
          risk === "ìœ„í—˜"
            ? "bg-red-100 text-red-700 border border-red-300"
            : risk === "ì£¼ì˜"
            ? "bg-amber-100 text-amber-700 border border-amber-300"
            : "bg-green-100 text-green-700 border border-green-300";
        const emoji = risk === "ìœ„í—˜" ? "âš ï¸" : risk === "ì£¼ì˜" ? "ğŸŸ¡" : "ğŸŸ¢";
        return (
          <span className={`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold shadow-sm ${style}`}>
            {emoji} {risk}
          </span>
        );
      }

      function App() {
        const [students, setStudents] = useState(() => {
          const saved = localStorage.getItem("students");
          return saved
            ? JSON.parse(saved)
            : Array.from({ length: 8 }, (_, i) => ({
                id: i + 1,
                name: `í•™ìƒ ${i + 1}`,
                risk: ["ì •ìƒ", "ì£¼ì˜", "ìœ„í—˜"][i % 3],
                recent: `2025-10-${String(10 + i).padStart(2, "0")}`,
                img: `https://picsum.photos/seed/student_${i}/200/200`,
              }));
        });

        // âœ… ì¸ë±ìŠ¤ê°€ ì•„ë‹Œ idë¡œ ì„ íƒ ìƒíƒœ ê´€ë¦¬
        const [selectedId, setSelectedId] = useState(null);
        const [filterRisk, setFilterRisk] = useState("ì „ì²´");
        const [showAdd, setShowAdd] = useState(false);
        const [newName, setNewName] = useState("");
        const [newRisk, setNewRisk] = useState("ì •ìƒ");

        useEffect(() => {
          localStorage.setItem("students", JSON.stringify(students));
        }, [students]);

        // âœ… ì„ íƒëœ í•™ìƒ ê°ì²´
        const selectedStudent = selectedId === null
          ? null
          : students.find((s) => s.id === selectedId) || null;

        // âœ… ì„ íƒëœ í•™ìƒì´ ë°ì´í„°ì—ì„œ ì‚¬ë¼ì¡Œì„ ë•Œ ìë™ í•´ì œ (ì‚­ì œ/í•„í„° ë³€ê²½ ëŒ€ë¹„)
        useEffect(() => {
          if (selectedId !== null && !students.some(s => s.id === selectedId)) {
            setSelectedId(null);
          }
        }, [students, selectedId]);

        const filteredStudents =
          filterRisk === "ì „ì²´"
            ? students
            : students.filter((s) => s.risk === filterRisk);

        // í•™ìƒ ì¶”ê°€
        const addStudent = () => {
          if (!newName.trim()) {
            alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
          }
          const newStudent = {
            id: Date.now(),
            name: newName.trim(),
            risk: newRisk,
            recent: new Date().toISOString().split("T")[0],
            img: `https://picsum.photos/seed/${Math.random()}/200/200`,
          };
          setStudents([...students, newStudent]);
          setShowAdd(false);
          setNewName("");
          setNewRisk("ì •ìƒ");
        };

        // í•™ìƒ ì‚­ì œ
        const deleteStudent = (id) => {
          if (confirm("ì •ë§ ì´ í•™ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            const updated = students.filter((s) => s.id !== id);
            setStudents(updated);
            setSelectedId(null); // ìƒì„¸ ì—´ë ¤ ìˆì—ˆë‹¤ë©´ ëª©ë¡ìœ¼ë¡œ ë³µê·€
          }
        };

        return (
          <div className="min-h-screen">
            <header className="px-6 py-4 bg-[#A4D4AE]/60 backdrop-blur border-b flex justify-between items-center">
              <div className="text-2xl font-bold text-[#2b6240]">êµì‚¬ìš© ë§¤ì•„ë¦¬</div>
              <button
                onClick={() => setShowAdd(true)}
                className="bg-[#6BB7FF] text-white px-4 py-2 rounded-lg text-sm hover:bg-[#5aa7f0]"
              >
                â• í•™ìƒ ì¶”ê°€
              </button>
            </header>

            <main className="max-w-6xl mx-auto p-6 space-y-6">
              {/* âœ… ëª©ë¡/ìƒì„¸ ë¶„ê¸°: id ê¸°ì¤€ */}
              {selectedStudent === null ? (
                <>
                  {/* ìœ„í—˜ë„ í•„í„° */}
                  <div className="flex gap-3 mb-6">
                    {["ì „ì²´", "ìœ„í—˜", "ì£¼ì˜", "ì •ìƒ"].map((r) => {
                      const count =
                        r === "ì „ì²´"
                          ? students.length
                          : students.filter((s) => s.risk === r).length;
                      const color =
                        r === "ìœ„í—˜"
                          ? "#F87171"
                          : r === "ì£¼ì˜"
                          ? "#FBBF24"
                          : r === "ì •ìƒ"
                          ? "#34D399"
                          : "#6BB7FF";
                      const isActive = filterRisk === r;
                      return (
                        <button
                          key={r}
                          onClick={() => setFilterRisk(r)}
                          className={`flex-1 rounded-xl p-3 text-center font-semibold transition ${
                            isActive ? "text-white scale-105 shadow-lg" : "text-white/80"
                          }`}
                          style={{ backgroundColor: color, opacity: isActive ? 1 : 0.8 }}
                        >
                          {r} {count}ëª…
                        </button>
                      );
                    })}
                  </div>

                  {/* í•™ìƒ ëª©ë¡ */}
                  {filteredStudents.length > 0 ? (
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-5">
                      {filteredStudents.map((s) => (
                        <div
                          key={s.id}
                          onClick={() => setSelectedId(s.id)}  // âœ… id ì €ì¥
                          className={`rounded-2xl border-4 p-4 hover:shadow-lg transition text-center cursor-pointer ${
                            s.risk === "ìœ„í—˜"
                              ? "border-red-400 bg-red-50"
                              : s.risk === "ì£¼ì˜"
                              ? "border-amber-400 bg-amber-50"
                              : "border-green-400 bg-green-50"
                          }`}
                        >
                          <img
                            src={s.img}
                            alt={s.name}
                            className="w-20 h-20 rounded-full mx-auto mb-2 object-cover border border-white shadow-sm"
                          />
                          <div className="font-medium text-base">{s.name}</div>
                          <div className="mt-2">
                            <RiskBadge risk={s.risk} />
                          </div>
                          <div className="text-xs text-gray-500 mt-2">
                            ìµœê·¼: {s.recent}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="text-center text-gray-400 py-10">
                      í•´ë‹¹ ë²”ì£¼ì˜ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                  )}
                </>
              ) : (
                <StudentDetail
                  student={selectedStudent}
                  onBack={() => setSelectedId(null)}
                  onDelete={() => deleteStudent(selectedStudent.id)}
                />
              )}
            </main>

            {/* í•™ìƒ ì¶”ê°€ ëª¨ë‹¬ */}
            {showAdd && (
              <div className="fixed inset-0 bg-black/40 flex justify-center items-center">
                <div className="bg-white p-6 rounded-2xl shadow-xl w-80 space-y-4">
                  <h2 className="text-lg font-semibold text-center text-[#2b6240]">ğŸ‘©â€ğŸ« í•™ìƒ ì¶”ê°€</h2>
                  <input
                    type="text"
                    className="border rounded-lg px-3 py-2 w-full"
                    placeholder="ì´ë¦„ ì…ë ¥"
                    value={newName}
                    onChange={(e) => setNewName(e.target.value)}
                  />
                  <select
                    className="border rounded-lg px-3 py-2 w-full"
                    value={newRisk}
                    onChange={(e) => setNewRisk(e.target.value)}
                  >
                    <option value="ì •ìƒ">ì •ìƒ</option>
                    <option value="ì£¼ì˜">ì£¼ì˜</option>
                    <option value="ìœ„í—˜">ìœ„í—˜</option>
                  </select>
                  <div className="flex justify-end gap-2">
                    <button
                      onClick={() => setShowAdd(false)}
                      className="px-3 py-2 rounded-lg border border-gray-300 text-gray-600"
                    >
                      ì·¨ì†Œ
                    </button>
                    <button
                      onClick={addStudent}
                      className="px-3 py-2 rounded-lg bg-[#6BB7FF] text-white hover:bg-[#5aa7f0]"
                    >
                      ì¶”ê°€
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      // í•™ìƒ ìƒì„¸ ë³´ê¸°
      function StudentDetail({ student, onBack, onDelete }) {
        const { useState } = React;
        const [selectedDiary, setSelectedDiary] = useState(0);

        const diaries = Array.from({ length: 3 }, (_, i) => ({
          id: i,
          date: `2025-10-${String(10 + i).padStart(2, "0")}`,
          image: `https://picsum.photos/seed/${student.id}_${i}/400/250`,
          text:
            i === 1
              ? "ì˜¤ëŠ˜ì€ ì¹œêµ¬ê°€ ë†€ë ¤ì„œ ì†ìƒí–ˆì–´ìš”. ê·¸ë˜ì„œ ìš¸ì—ˆì–´ìš”."
              : i === 2
              ? "ì˜¤ëŠ˜ì€ ë¬´ì„œìš´ ê¿ˆì„ ê¿¨ì–´ìš”. ìƒ‰ì¹ ì„ ì§„í•˜ê²Œ í–ˆì–´ìš”."
              : "ì˜¤ëŠ˜ì€ í•™êµì—ì„œ ì¦ê±°ì› ì–´ìš”!",
          dangerWord: i === 1 ? 3 : 0,
          negColorRatio: i === 2 ? 45 : 10,
        }));

        const flagged = diaries.filter(
          (d) => d.dangerWord > 0 || d.negColorRatio > 30
        );

        return (
          <div className="space-y-5">
            {/* ìƒë‹¨ */}
            <div className="flex items-center gap-3">
              <button className="p-2 hover:bg-gray-100 rounded-lg" onClick={onBack}>
                â¬… ë’¤ë¡œ
              </button>
              <h2 className="text-2xl font-semibold text-[#2b6240]">
                {student.name} ê·¸ë¦¼ì¼ê¸° ë¶„ì„
              </h2>
              <button
                onClick={onDelete}
                className="ml-auto text-red-500 text-sm hover:underline"
              >
                ğŸ—‘ í•™ìƒ ì‚­ì œ
              </button>
            </div>

            {/* ìœ„í—˜ ì¼ê¸° */}
            <div className="border rounded-2xl bg-white p-4 space-y-3">
              <div className="font-semibold text-[#8a3a3a]">
                âš ï¸ ìœ„í—˜ ê°ì§€ ì¼ê¸° ({flagged.length})
              </div>
              <div className="flex gap-3 overflow-x-auto pb-2">
                {flagged.length > 0 ? (
                  flagged.map((d) => (
                    <div
                      key={d.id}
                      onClick={() => setSelectedDiary(d.id)}
                      className={`flex-shrink-0 w-32 border rounded-xl overflow-hidden cursor-pointer ${
                        selectedDiary === d.id
                          ? "ring-2 ring-[#F87171]"
                          : "hover:ring-2 hover:ring-[#FCA5A5]"
                      }`}
                    >
                      <img src={d.image} className="w-full h-24 object-cover" alt={`ì¼ê¸° ${d.date}`} />
                      <div className="p-1 text-xs text-center text-gray-600">
                        {d.date}
                      </div>
                    </div>
                  ))
                ) : (
                  <div className="text-gray-400 text-sm">ìœ„í—˜ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                )}
              </div>
            </div>

            {/* ì„ íƒëœ ì¼ê¸° ìƒì„¸ */}
            <div className="border rounded-2xl bg-white p-4">
              <div className="font-semibold mb-3">ì„ íƒëœ ì¼ê¸° ìƒì„¸ ë³´ê¸°</div>
              <div className="rounded-xl border overflow-hidden bg-white">
                <img
                  src={diaries[selectedDiary].image}
                  className="w-full object-cover max-h-[320px]"
                  alt="ì„ íƒëœ ì¼ê¸° ì´ë¯¸ì§€"
                />
                <div className="p-3 text-sm leading-relaxed">
                  {diaries[selectedDiary].text}
                </div>
                <div className="flex justify-around text-xs text-gray-600 border-t py-2 bg-gray-50">
                  <div>ìœ„í—˜ ë‹¨ì–´: {diaries[selectedDiary].dangerWord}íšŒ</div>
                  <div>ë¶€ì • ìƒ‰ìƒ: {diaries[selectedDiary].negColorRatio}%</div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
